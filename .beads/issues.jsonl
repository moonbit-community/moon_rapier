{"id":"moon_rapier-105","title":"Support rotated cuboids in narrowphase + physics contact resolution","description":"Today NarrowPhase::update_with_pairs and PhysicsPipeline contact separation treat cuboids as axis-aligned and ignore collider.world_rotation. After fixing collider world pose composition, rotated parents will produce rotated cuboids with incorrect collision behavior.\\n\\nImplement minimal 2D OBB support (Rapier-aligned semantics):\\n- Ball vs cuboid intersection/separation in collider_set.mbt should account for rotation (transform into cuboid local frame).\\n- Cuboid vs cuboid intersection/separation should use SAT on the 4 axes.\\n- Add regression tests for rotated cuboid vs ball, and rotated cuboid vs cuboid.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T15:56:15.247936+08:00","created_by":"Milky2018","updated_at":"2026-01-23T16:07:46.700184+08:00","closed_at":"2026-01-23T16:07:46.700184+08:00","close_reason":"Implemented rotation-aware cuboid collision handling: NarrowPhase now tests ball/cuboid and cuboid/cuboid with rotations; PhysicsPipeline contact separation uses OBB SAT + rotated circle-vs-OBB resolution; QueryPipeline raycast/point query respect cuboid rotation; added regression tests.","labels":["collision","rapier-parity"]}
{"id":"moon_rapier-14b","title":"Enable full bd sync (git sparse-checkout missing on git 2.23)","description":"Problem:\n- This repo uses `bd sync`, but the system git is 2.23.0 which does not ship the `git sparse-checkout` subcommand.\n- `bd sync` uses `git sparse-checkout` internally and fails without it.\n\nFix (local workaround):\n- Install a `git-sparse-checkout` no-op shim in `/usr/local/bin` so `bd sync` can proceed with a full checkout.\n\nFollow-up options:\n- Upgrade git to a modern version (preferred, removes the need for the shim).\n- Or keep the shim in place on this machine.\n","status":"closed","priority":1,"issue_type":"chore","owner":"842376130@qq.com","created_at":"2026-01-23T14:21:45.934051+08:00","created_by":"Milky2018","updated_at":"2026-01-23T14:44:13.539069+08:00","closed_at":"2026-01-23T14:44:13.539069+08:00","close_reason":"Unblocked bd sync on git 2.23 by installing a git-sparse-checkout no-op shim in /usr/local/bin (so sync falls back to full checkout).","labels":["bd","tooling"]}
{"id":"moon_rapier-22a","title":"Port Rapier narrowphase filters (ActiveCollisionTypes + collision_groups)","description":"Implement the same filtering rules as Rapier when building contact/intersection pairs:\\n- Same-parent exclusion\\n- ActiveCollisionTypes filtering (skip if neither collider allows the body-type pair)\\n- InteractionGroups collision_groups filtering\\nAdd MoonBit tests ported from Rapier behavior.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T14:10:23.106518+08:00","created_by":"Milky2018","updated_at":"2026-01-23T14:13:53.340093+08:00","closed_at":"2026-01-23T14:13:53.340093+08:00","close_reason":"Implemented Rapier-style narrowphase filtering for ActiveCollisionTypes and collision_groups; added regression tests.","labels":["collision","narrowphase","rapier-parity"]}
{"id":"moon_rapier-27j","title":"Configure real git remote (origin currently points to .private/origin.git)","description":"This repo had no git remote configured. To satisfy the AGENTS workflow, I created a local bare repo at .private/origin.git and set it as origin.\\n\\nFollow-up: set origin to the intended upstream (GitHub/GitLab/internal) and push; then remove/ignore the local bare repo if desired.","status":"closed","priority":1,"issue_type":"chore","owner":"842376130@qq.com","created_at":"2026-01-23T14:23:02.273232+08:00","created_by":"Milky2018","updated_at":"2026-01-23T14:41:53.049298+08:00","closed_at":"2026-01-23T14:41:53.049298+08:00","close_reason":"Set git origin to https://github.com/moonbit-community/moon_rapier.git and pushed master.","labels":["git","tooling"]}
{"id":"moon_rapier-795","title":"Port BroadPhaseBvh tree structure (reduce O(n^2) pairs)","description":"BroadPhaseBvh currently builds overlap pairs with an O(n^2) AABB scan. Rapier uses a BVH (parry::partitioning::Bvh) with incremental optimization and BVTT traversal.\\n\\nImplement a simple 2D BVH for colliders (AABB + leaf indices) and use it to generate overlap pairs faster than O(n^2). Keep API stable (BroadPhaseBvh::update + pairs). Add tests to ensure pair results match the naive implementation for random seeds.","status":"closed","priority":3,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T15:56:15.342754+08:00","created_by":"Milky2018","updated_at":"2026-01-23T16:17:36.800797+08:00","closed_at":"2026-01-23T16:17:36.800797+08:00","close_reason":"Replaced O(n^2) broadphase pair scan with a simple BVH build + BVTT traversal; pairs are deduped via traversal structure and sorted for determinism; added regression test comparing BVH pairs with naive AABB pairing on randomized scenes.","labels":["broadphase","performance","rapier-parity"]}
{"id":"moon_rapier-a48","title":"Port QueryPipeline advanced queries (cast_ray_and_get_normal + project_point + intersect_aabb_conservative)","description":"Align collision::QueryPipeline APIs with rapier-reference/src/pipeline/query_pipeline.rs (subset for 2D Ball/Cuboid):\\n- cast_ray_and_get_normal\\n- project_point (PointProjection)\\n- intersect_aabb_conservative\\n\\nAdd minimal types RayIntersection + PointProjection, and tests for normals/projection/AABB queries.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T16:35:58.848556+08:00","created_by":"Milky2018","updated_at":"2026-01-23T16:54:11.947881+08:00","closed_at":"2026-01-23T16:54:11.947881+08:00","close_reason":"Implemented QueryPipeline advanced queries (cast_ray_and_get_normal, project_point, intersect_aabb_conservative) with Rapier-aligned semantics; added RayIntersection/PointProjection and regression tests; cached AABBs for conservative queries.","labels":["query","rapier-parity"]}
{"id":"moon_rapier-cpf","title":"Port Rapier QueryFilter flags (exclude body types + sensors/solids)","description":"Align QueryPipeline QueryFilter behavior with rapier-reference QueryFilterFlags:\\n- exclude_fixed / exclude_kinematic / exclude_dynamic\\n- exclude_sensors / exclude_solids\\n- only_dynamic / only_kinematic / only_fixed\\n\\nUpdate query_filter_test in collision/query_pipeline.mbt accordingly, and add tests covering sensor/solid and body-type filtering.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T16:27:16.368047+08:00","created_by":"Milky2018","updated_at":"2026-01-23T16:30:43.383842+08:00","closed_at":"2026-01-23T16:30:43.383842+08:00","close_reason":"Implemented Rapier-style QueryFilter flags: exclude_fixed/kinematic/dynamic and exclude_sensors/solids plus only_* helpers; updated QueryPipeline filtering logic; added tests for sensor/solid and fixed-vs-dynamic filtering.","labels":["query","rapier-parity"]}
{"id":"moon_rapier-l8r","title":"Implement QueryPipeline shape cast queries (Ball/Cuboid 2D)","description":"Reference: rapier-reference/src/pipeline/query_pipeline.rs (shape_cast / cast_shape).\n\nAdd minimal 2D sweep queries needed by character controller:\n- shape_cast for moving a Ball or Cuboid against Ball/Cuboid colliders.\n- Return a hit with toi + normal (and any minimal witness info needed by controller).\n- Respect QueryFilter (groups + flags + excluded handles).\n\nAcceptance:\n- Unit tests for basic ball-vs-ball sweep and ball-vs-cuboid sweep (including rotated cuboid).\n- moon test passes.","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T16:57:57.905521+08:00","created_by":"Milky2018","updated_at":"2026-01-23T16:57:57.905521+08:00","labels":["control","query","rapier-parity"]}
{"id":"moon_rapier-p6x","title":"Align BroadPhaseBvh with Rapier (pairs + update)","description":"Rapier reference (0.32.0) uses BroadPhaseBvh as default broadphase (see rapier-reference/src/geometry/broad_phase_bvh.rs).\n\nImplement a minimal BroadPhaseBvh in MoonBit that:\n- Computes conservative AABB overlap pairs (Ball/Cuboid, using prediction_distance expansion)\n- Exposes pairs for NarrowPhase/CollisionPipeline\n- Integrates CollisionPipeline to use broadphase-generated pairs instead of the current O(n^2) scan\n\nAdd focused tests for pair generation and prediction_distance behavior.\n","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T14:10:29.5876+08:00","created_by":"Milky2018","updated_at":"2026-01-23T14:32:15.54095+08:00","closed_at":"2026-01-23T14:32:15.54095+08:00","close_reason":"Aligned BroadPhaseBvh with rapier-reference naming; added minimal pair generation (AABB overlap + prediction_distance), integrated CollisionPipeline to use broadphase pairs, and added focused tests.","labels":["broadphase","collision","rapier-parity"]}
{"id":"moon_rapier-set","title":"Port KinematicCharacterController::move_shape (2D)","description":"Reference: rapier-reference/src/control/character_controller.rs.\n\nReplace the current stub in control/character_controller.mbt with a Rapier-aligned implementation (subset for 2D Ball/Cuboid):\n- Handle sliding, snapping to ground (CharacterLength), and max slope climb angle.\n- Use QueryPipeline queries (raycasts / shape casts) for obstacle detection.\n- Emit CharacterCollision callbacks with useful info (at least collider handle + normal).\n\nAcceptance:\n- Port a small set of upstream behavior tests (grounded vs not, snap-to-ground on/off, simple wall slide).\n- moon test passes.","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T16:58:00.450226+08:00","created_by":"Milky2018","updated_at":"2026-01-23T16:58:00.450226+08:00","labels":["control","rapier-parity"],"dependencies":[{"issue_id":"moon_rapier-set","depends_on_id":"moon_rapier-l8r","type":"blocks","created_at":"2026-01-23T16:58:16.566509+08:00","created_by":"Milky2018"}]}
{"id":"moon_rapier-trh","title":"Fix collider world pose composition with parent rotation","description":"Align ColliderSet::sync_with_bodies with Rapier semantics: collider.position = body.position * collider.position_wrt_parent. Today we just add translations and ignore parent rotation, which makes attached colliders drift when the parent rotates.\\n\\nTasks:\\n- Update update_collider_world_pose to rotate local_translation by parent rotation before adding.\\n- Update BroadPhaseBvh AABB computation for rotated cuboids (use |cos|/|sin| extents) so broadphase pairs remain conservative.\\n- Add regression test: parent rotated 90deg, local offset (1,0) becomes world offset (0,1).","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T15:44:10.122688+08:00","created_by":"Milky2018","updated_at":"2026-01-23T15:50:48.052092+08:00","closed_at":"2026-01-23T15:50:48.052092+08:00","close_reason":"Fixed collider world pose composition: apply parent rotation when combining local pose; broadened cuboid AABB computation for rotated shapes; added regression test.","labels":["collision","rapier-parity"]}
{"id":"moon_rapier-vmc","title":"Implement QueryPipeline core queries (raycast/point query)","description":"Port Rapier QueryPipeline APIs incrementally (2D):\\n- raycast\\n- point_query\\n- QueryFilter (exclude body + InteractionGroups)\\nPort upstream behavior tests/fixtures first.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T14:10:38.009035+08:00","created_by":"Milky2018","updated_at":"2026-01-23T15:29:04.750746+08:00","closed_at":"2026-01-23T15:29:04.750746+08:00","close_reason":"Implemented QueryPipeline (raycast + point query) and QueryFilter in collision package; BroadPhaseBvh can now build a query pipeline; removed obsolete query package to avoid cycles.","labels":["query","rapier-parity"]}
